<!DOCTYPE html>
<html>
    <head>
        <title>ProjectDarkness</title>
        <style>
            body{
                background-color: rgb(0, 0, 0);
            }
        </style>
    </head>
    <body>
        <!--
            Images
        -->
        <img id="player" src="images/player.png"width="0"height="0">
        <img id="playerR" src="images/playerRight.png"width="0"height="0">
        <img id="sword" src="images/sword.png"width="0"height="0">
        <img id="swordR" src="images/swordRight.png"width="0"height="0">
        <img id="bg" src="images/bg.png"width="0"height="0">
        <img id="gamebg" src="images/gameBG.png"width="0"height="0">
        <img id="title" src="images/title.png"width="0"height="0">
        <img id="info" src="images/infoPAGE.png"width="0"height="0">
        <img id="coin" src="images/coin.png"width="0"height="0">
        <img id="light" src="images/light.png"width="0"height="0">
        <img id="lightC" src="images/lightC.png"width="0"height="0">
        <p align="center">
            <canvas id="myCanvas"width="720"height="480"style="border:5px solid #ffffff;"></canvas>
        </p>
        <!--Actual game code-->
        <script>
            // TODO companion
            var canvas = document.getElementById("myCanvas");
            var c = canvas.getContext("2d");
            var bg = document.getElementById("bg");
            var titleIMG = document.getElementById("title");
            var images = {player:document.getElementById("player"),playerR:document.getElementById("playerR"),sword:document.getElementById("sword"),swordR:document.getElementById("swordR"),info:document.getElementById("info"),gbg:document.getElementById("gamebg"),coin:document.getElementById("coin"),light:document.getElementById("light"),lightC:document.getElementById("lightC")};

            let p = {x:100,y:100,width:50,height:70};
            let swordPOS = {x:370,y:250,width:35,height:60};
            let project = {time:0,dir:"right",scene:0,swordActive:false,titleY:100,collected:false,coinX:10,coinY:420,cc:false,coins:0,ogcoins:0};

            let leftKeyPresed = false;
            let rightKeyPressed = false;
            let upKeyPressed = false;
            let downKeyPressed = false;
        
            function clear(){
                c.drawImage(images.gbg,0,0,720,480);
            }
            function drawPlayer(x,y){
                if(project.dir == "right"){
                    c.drawImage(images.player,x-65,y-30,190,130);
                }
                else{
                    c.drawImage(images.playerR,x-65,y-30,190,130);
                }
            }
            function newCoin(x,y){
                project.coinX = x;
                project.coinY = y;
                if(!project.cc){
                    c.drawImage(images.coin,x,y,30,60);
                }
            }
            function drawHitbox(x,y,w,h){
                c.fillStyle = "white";
                c.fillRect(x,y,w,h);
            }
            function text(text){
                c.globalAlpha = 0.3;
                c.fillStyle = "black";
                c.fillRect(0,0,canvas.width,60);
                c.fillStyle = "white";
                c.font = 'bold 24px sans serif';
                c.fillText(text,canvas.width/2-100,30);
                c.globalAlpha = 1;
            }
            function fontInit(){
                c.fillStyle = "white";
                c.font = 'bold 12px sans serif';
            }
            function drawSword(){
                if(project.swordActive){
                    if(project.dir == "right"){
                        c.drawImage(images.sword,p.x-40,p.y-55,190,190);
                    }
                    else{
                        c.drawImage(images.swordR,p.x-95,p.y-55,190,190);
                    }
                }
                else{
                    c.drawImage(images.swordR,300,200,190,190);
                }
            }
            function drawTitle(){
                c.drawImage(titleIMG,20,project.titleY-140,410,250);
                fontInit();
                c.fillText("(c)ClassicMC 2022 ,\"i\"for info",545,470);
            }
            function drawSL(type,x,y,w,h){
                c.globalAlpha = 0.3;
                if(type == "rect"){
                    c.drawImage(images.light,x,y,50,480);
                }
                else{
                    c.drawImage(images.lightC,x,y,w,h);
                }
                c.globalAlpha = 1;
            }
            function redraw(){
                if(project.scene == 0){
                    clear();
                    c.drawImage(bg,0,0,720,480);
                    drawSL("circle",480,440,300,50);
                    drawTitle();
                }
                if(project.scene == 1){
                    clear();
                    drawPlayer(p.x,p.y);
                    drawSword();
                    drawSL("rect",680,0);
                    newCoin(10,420);
                    text("Get your sword");
                }
                if(project.scene == -1){
                    clear();
                    c.drawImage(info,0,0,720,480);
                }
            }
            function checkCollisions(x,y,width,height){
                if(x < p.x + p.width &&
                x + width > p.x &&
                y < p.y + p.height &&
                y + height > p.y){
                    project.collected = true;
                }  
            }   
            //Just a whole buch of garbage to get the movement working correctly
            function keyPressed(evt){
                if(evt.keyCode == 37){
                    leftKeyPressed = true;
                }
                if(evt.keyCode == 39){
                    rightKeyPressed = true;
                }
                if(evt.keyCode == 38){
                    upKeyPressed = true;
                }
                if(evt.keyCode == 40){
                    downKeyPressed = true;
                }

            }
            function keyReleased(evt){
                if(evt.keyCode == 37){
                    leftKeyPressed = false;
                }
                if(evt.keyCode == 39){
                    rightKeyPressed = false;
                }
                if(evt.keyCode == 38){
                    upKeyPressed = false;
                }
                if(evt.keyCode == 40){
                    downKeyPressed = false;
                }

            }
            function playerMove(){
                if(leftKeyPressed == true){
                    if(p.x >= -8){
                        project.dir = "left";
                        p.x -= 3;
                    }
                }
                if(rightKeyPressed == true){
                    if(p.x <= 683){
                        project.dir = "right";
                        p.x += 3;
                    }
                }
                if(upKeyPressed == true){
                    if(p.y >= -14){
                        p.y -= 3;
                    }
                }
                if(downKeyPressed == true){
                    if(p.y <= 406){
                        p.y += 3;
                    }
                }
            }
            document.addEventListener('keydown',function (evt){
                if(event.keyCode == 32){
                    if(project.scene == 0){
                        project.scene = 1;
                    }
                    else if(project.scene == -1){
                        project.scene =0;
                    }
                }
                if(event.keyCode == 73){
                    if(project.scene == 0){
                        project.scene = -1;
                    }
                    else{
                        alert("Coins:"+project.coins);
                    }
                }
            });
            //Main game loop
            window.main = function (){
                window.requestAnimationFrame( main );
                redraw();
                document.addEventListener('keydown',keyPressed);
                document.addEventListener('keyup',keyReleased);
                project.titleY += Math.sin(0+(project.time*-0.5)*0.5);
                project.time += 0.5;
                playerMove();
                checkCollisions(swordPOS.x,swordPOS.y,swordPOS.width,swordPOS.height);
                if(project.collected){
                    project.collected = false;
                    project.swordActive = true;
                }
                checkCollisions(project.coinX,project.coinY,30,60);
                if(project.collected){
                    project.collected = false;
                    project.cc = true;
                    if(project.coins <= project.ogcoins){
                        project.coins ++;
                    }
                }
            }
            project.ogcoins = project.coins;
            main();
        </script>    
    </body>
</html>